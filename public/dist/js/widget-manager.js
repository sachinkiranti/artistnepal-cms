!function(t){t.fn.filemanager=function(e,i){e=e||"file",this.on("click",function(a){var n=i&&i.prefix?i.prefix:"/filemanager",o=t("#"+t(this).data("input")),d=t("#"+t(this).data("preview"));return window.open(n+"?type="+e,"FileManager","width=900,height=600"),window.SetUrl=function(e){var i=e.map(function(t){return t.url}).join(",");o.val("").val(i).trigger("change"),d.html(""),e.forEach(function(e){d.append(t("<img>").css({height:"5rem",width:"45%"}).attr("src",e.thumb_url))}),d.trigger("change")},!1})}}(jQuery),$(function(){var t={init:function(){this.cacheDom(),this.bind(),this.initDraggable(),this.initDroppable()},cacheDom:function(){this.$document=$(document),this.$widgetDroppableArea=$(".widget-droppable-area"),this.$modal=$("#edit-model"),this.$showTotalRectangeInput=$(".show-total-rectangle-input-wrapper")},bind:function(){this.$widgetDroppableArea.on("click",".remove-widget",this.removeWidget),this.$document.on("change","select[name=template]",this.previewWidgetTemplate),this.$document.on("click",".widget-preview-thumbnail",this.showWidgetOverlay),this.$widgetDroppableArea.on("click",".save-widget",this.saveWidget),this.$widgetDroppableArea.on("click",".delete-widget",this.deleteWidget),this.$widgetDroppableArea.on("click",".edit-widget",this.editWidget),this.$widgetDroppableArea.on("click",".add-advertisement",this.addAdvertisement),this.$document.on("click",".update-widget",this.updateWidget),this.$document.on("click","#lfm",this.showFileManager),this.$modal.on("show.bs.modal",this.getEditModalReady)},addAdvertisement:function(){utils.location(router.get("admin.advertisement.edit").replace("{component}",$(this).data("component")).replace("{widget}",$(this).data("widget")))},showFileManager:function(){$(this).filemanager("image")},getEditModalReady:function(){t.$modal.find(".update-widget").prop("disabled",!1).html("Save changes")},updateWidget:function(){$(this).prop("disabled",!0).html('Save changes <i class="fa fa-spinner fa-spin"></i>');var e=$(this).parents(".modal-content").find("form");if(!e[0].checkValidity())return e.submit(),!1;var i={};return $.each(e.serializeArray(),function(){i[this.name]=this.value}),delete i._method,utils.http.post(router.get("admin.update.widget").replace("{id}",i.widget_id),i).done(function(e){t.$modal.modal("hide"),utils.toast("Widget updated successfully!"),utils.reload(1e3)}).fail(function(t,e){}),!1},editWidget:function(){var e=$(this).data("widget"),i=$(this).data("component"),a=$(this).data("identifier");return utils.http.post(router.get("admin.edit.widget").replace("{id}",e),{widget_id:e,component:i,identifier:a}).done(function(e){t.$modal.find(".modal-title").text(a.replace("-"," ").toUpperCase()),t.$modal.find(".modal-body").html(e.body),t.$modal.modal("show")}).fail(function(t,e){}),!1},deleteWidget:function(){var t=$(this).data("widget"),e=$(this).data("component"),i=$(this).parents(".widget-show");return swal({title:"Are you sure?",text:"Are you sure that you want to delete this widget?",type:"warning",showCancelButton:!0,closeOnConfirm:!1,confirmButtonText:"Yes, Delete it!",confirmButtonColor:"#ec6c62"},function(a){a&&utils.http.post(router.get("admin.delete.widget"),{widget_id:t,component_name:e}).done(function(t){i.remove(),swal.close(),utils.toast("Widget deleted successfully!")}).fail(function(t,e){})}),!1},saveWidget:function(){var t=$(this).closest("form"),e=$(this).closest(".widget-box");if(!t[0].checkValidity())return t.submit(),!1;var i={};return $.each(t.serializeArray(),function(){i[this.name]=this.value}),utils.http.post(router.get("admin.save.widget"),i).done(function(t){utils.toast("Widget saved successfully!"),e.replaceWith(t.body)}).fail(function(t,e){}),!1},showWidgetOverlay:function(){$("#overlay-wrapper").css({backgroundImage:`url(${this.src})`}).addClass("open").one("click",function(){$(this).removeClass("open")})},removeWidget:function(){$(this).parents(".widget-box").remove(),utils.toast("Widget removed successfully!")},previewWidgetTemplate:function(){var e=$(this).next(".widget-previewer"),i=$(this).val(),a=utils.getImagePath("widgets/"+i+".png");utils.fileExists(a)||(a=utils.getImagePath("no-preview.jpeg")),e.find("img").attr("src",a),e.show(),t.showOrHideExtraInput(i)},showOrHideExtraInput:function(t){"list-with-rectangle-image"!==t?$(".show-total-rectangle-input-wrapper").hide():$(".show-total-rectangle-input-wrapper").show()},initDraggable:function(){var t=0;$(".widget-draggable").draggable({cursor:"move",revert:"invalid",helper:function(){var e=$(this).clone();return e.attr("id",(++t).toString()),e},distance:5})},initDroppable:function(){$(".widget-droppable").droppable({hoverClass:"ui-state-active",tolerance:"pointer",accept:function(t,e){return!0},drop:function(t,e){var i,a,n;$(e.helper).hasClass("widget-draggable")&&((n=$(e.helper).clone()).removeClass("draggable").removeClass("widget-draggable").addClass("editable").removeAttr("style"),i=n.find("."+n.data("widget")+"-wrapper"),a=n.data("widget"),utils.http.post(router.get("admin.render.widget"),{identifier:a,component:$(this).data("component")}).done(function(t){utils.toast("Widget loaded successfully!"),i.html(t.body)}).fail(function(t,e){}),$(this).append(n))}}).sortable({revert:!1})}};t.init()});
