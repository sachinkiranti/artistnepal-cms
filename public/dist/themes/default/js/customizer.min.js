!function(t){t.fn.filemanager=function(e,i){e=e||"file",this.on("click",function(n){var a=i&&i.prefix?i.prefix:"/filemanager",o=t("#"+t(this).data("input")),d=t("#"+t(this).data("preview"));return window.open(a+"?type="+e,"FileManager","width=900,height=600"),window.SetUrl=function(e){var i=e.map(function(t){return t.url}).join(",");o.val("").val(i).trigger("change"),d.html(""),e.forEach(function(e){d.append(t("<img>").css({height:"5rem",width:"45%"}).attr("src",e.thumb_url))}),d.trigger("change")},!1})}}(jQuery),$(function(){var t={init:function(){this.cacheDom(),this.bind(),this.initFirst()},cacheDom:function(){this.$document=$(document),this.$modal=$("#edit-model"),this.$showTotalRectangeInput=$(".show-total-rectangle-input-wrapper")},bind:function(){this.$document.on("click",".remove-widget",this.removeWidget),this.$document.on("change","select[name=template]",this.previewWidgetTemplate),this.$document.on("click",".widget-preview-thumbnail",this.showWidgetOverlay),this.$document.on("click",".save-widget",this.saveWidget),this.$document.on("click",".delete-widget",this.deleteWidget),this.$document.on("click",".edit-widget",this.editWidget),this.$document.on("click",".add-advertisement",this.addAdvertisement),this.$document.on("click",".update-widget",this.updateWidget),this.$document.on("click","#lfm",this.showFileManager),this.$modal.on("show.bs.modal",this.getEditModalReady)},initFirst:function(){this.$modal.modal("hide")},addAdvertisement:function(){utils.location(router.get("admin.advertisement.edit").replace("{component}",$(this).data("component")).replace("{widget}",$(this).data("widget")))},showFileManager:function(){$(this).filemanager("image")},getEditModalReady:function(){t.$modal.find(".update-widget").prop("disabled",!1).html("Save changes")},updateWidget:function(){$(this).prop("disabled",!0).html('Save changes <i class="fa fa-spinner fa-spin"></i>');var e=$(this).parents(".modal-content").find("form");if(!e[0].checkValidity())return e.submit(),!1;var i={};return $.each(e.serializeArray(),function(){i[this.name]=this.value}),delete i._method,utils.http.post(router.get("admin.update.widget").replace("{id}",i.widget_id),i).done(function(e){t.$modal.modal("hide"),utils.reload(1e3)}).fail(function(t,e){}),!1},editWidget:function(){var e=$(this).data("widget"),i=$(this).data("component"),n=$(this).data("identifier");return utils.http.post(router.get("admin.edit.widget").replace("{id}",e),{widget_id:e,component:i,identifier:n}).done(function(e){t.$modal.find(".modal-title").text(n.replace("-"," ").toUpperCase()),t.$modal.find(".modal-body").html(e.body),t.$modal.modal("show")}).fail(function(t,e){}),!1},deleteWidget:function(){var t=$(this).data("widget"),e=$(this).data("component"),i=$(this).parents(".widget-show");return swal({title:"Are you sure?",text:"Are you sure that you want to delete this widget?",type:"warning",showCancelButton:!0,closeOnConfirm:!1,confirmButtonText:"Yes, Delete it!",confirmButtonColor:"#ec6c62"},function(n){n&&utils.http.post(router.get("admin.delete.widget"),{widget_id:t,component_name:e}).done(function(t){i.remove(),swal.close()}).fail(function(t,e){})}),!1},saveWidget:function(){var t=$(this).closest("form"),e=$(this).closest(".widget-box");if(!t[0].checkValidity())return t.submit(),!1;var i={};return $.each(t.serializeArray(),function(){i[this.name]=this.value}),utils.http.post(router.get("admin.save.widget"),i).done(function(t){e.replaceWith(t.body),utils.reload()}).fail(function(t,e){}),!1},showWidgetOverlay:function(){$("#overlay-wrapper").css({backgroundImage:`url(${this.src})`}).addClass("open").one("click",function(){$(this).removeClass("open")})},removeWidget:function(){$(this).parents(".widget-box").remove()},previewWidgetTemplate:function(){var e=$(this).next(".widget-previewer"),i=$(this).val(),n=utils.getImagePath("widgets/"+i+".png");e.find(".loading-images").show(),e.find("img").hide(),utils.fileExists(n)||(n=utils.getImagePath("no-preview.jpeg")),e.find("img").attr("src",n),e.find(".loading-images").hide(),e.find("img").show(),e.show(),t.showOrHideExtraInput(i)},showOrHideExtraInput:function(t){"list-with-rectangle-image"!==t?$(".show-total-rectangle-input-wrapper").hide():$(".show-total-rectangle-input-wrapper").show()}};t.init()});
